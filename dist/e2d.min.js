(function(a,b){'object'==typeof exports&&'undefined'!=typeof module?module.exports=b():'function'==typeof define&&define.amd?define(b):a.e2d=b()})(this,function(){'use strict';var a=Math.tan,b=Math.sin,c=Math.cos,d=Math.PI;const e=(a,b)=>{const c=[];let d,e;for(let f=0;f<a.length;f++)[d,e]=a[f],c.push([b[0]*d+b[2]*e+b[4],b[1]*d+b[3]*e+b[5]]);return c},g=CanvasRenderingContext2D.prototype.currentTransform?document.createElement('canvas').getContext('2d').currentTransform:null;let h=0;const f=g?([h,a,b,c,d,e])=>(g.a=h,g.b=a,g.c=b,g.d=c,g.e=d,g.f=e,({a:h,b:a,c:b,d:c,e:d,f:e}=g.inverse()),[h,a,b,c,d,e]):([g,a,i,j,d,e])=>(h=1/(g*j-i*a),[j*h,-i*h,-a*h,g*h,(a*e-d*j)*h,(d*a-g*e)*h]),i=([a,b],[[c,d],[e,f]])=>a>c&&b>d&&a<e&&b<f,j=([a,b],[c,d,e])=>(c-a)**2+(d-b)**2<e**2;var k=function(a,b){for(var c=a[0],d=a[1],e=!1,f=0,g=b.length-1;f<b.length;g=f++){var h=b[f][0],i=b[f][1],j=b[g][0],k=b[g][1];i>d!=k>d&&c<(j-h)*(d-i)/(k-i)+h&&(e=!e)}return e};const l=(a,{props:{name:b,args:c,count:d}})=>{0===d?a[b]():1===d?a[b](c[0]):2===d?a[b](c[0],c[1]):3===d?a[b](c[0],c[1],c[2]):4===d?a[b](c[0],c[1],c[2],c[3]):5===d?a[b](c[0],c[1],c[2],c[3],c[4]):6===d?a[b](c[0],c[1],c[2],c[3],c[4],c[5]):7===d?a[b](c[0],c[1],c[2],c[3],c[4],c[5],c[6]):8===d?a[b](c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7]):9===d?a[b](c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8]):void 0},m=[],n=m.concat;var o=([a,b],c)=>{const d=document.createElement('canvas').getContext('2d');d.canvas.width=1,d.canvas.height=1;for(let e=0;e<c.length;e++){for(;c[e]&&c[e].constructor===Array;)c=n.apply(m,c);c[e]&&l(d,c[e])}return d.isPointInPath(a,b)};const p=()=>!1;class q{constructor(a,b){return this.type=a,this.props=b,Object.seal(this)}}Object.seal(q),Object.seal(q.prototype);var r=2*d;const s=(a)=>()=>new q('call',{name:a,args:[],count:0});var t=s('beginPath');const u=(a)=>(...b)=>new q('call',{name:a,args:2<b.length?b:[0,0,b[0],b[1]],count:4});var v=u('clearRect');const w=[s('save'),s('beginPath')],x=s('clip'),y=s('restore');var z=s('closePath');const A=(a)=>{const b=new q('pop',{stack:a});return(c,...d)=>[new q('push',{stack:a,value:c}),...d,b]};var B=A('direction');var C=s('restore');var D=s('fill');var E=u('fillRect'),F=A('fillStyle');const G=(a)=>(...b)=>new q('call',{name:a,args:3<=b.length?b:[b[0],0,0],count:4<=b.length?4:3});var H=G('fillText'),I=A('font'),J=A('globalAlpha'),K=A('globalCompositeOperation');var L=A('imageSmoothingEnabled'),M=function(a,b){return b={exports:{}},a(b,b.exports),b.exports}(function(a,b){b=a.exports=function(a){if(a&&'object'==typeof a){var b=a.which||a.keyCode||a.charCode;b&&(a=b)}if('number'==typeof a)return f[a];var e=a+'',g=c[e.toLowerCase()];if(g)return g;var g=d[e.toLowerCase()];return g?g:1===e.length?e.charCodeAt(0):void 0};var c=b.code=b.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,command:91,"left command":91,"right command":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},d=b.aliases={windows:91,"⇧":16,"⌥":18,"⌃":17,"⌘":91,ctl:17,control:17,option:18,pause:19,break:19,caps:20,return:13,escape:27,spc:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91};for(e=97;123>e;e++)c[String.fromCharCode(e)]=e-32;for(var e=48;58>e;e++)c[e-48]=e;for(e=1;13>e;e++)c['f'+e]=e+111;for(e=0;10>e;e++)c['numpad '+e]=e+96;var f=b.names=b.title={};for(e in c)f[c[e]]=e;for(var g in d)c[g]=d[g]});var N=A('lineCap'),O=A('lineDash'),P=A('lineDashOffset'),Q=A('lineJoin'),R=A('lineWidth'),S=A('miterLimit');const T=(a)=>(b,c)=>new q('call',{name:a,args:[b,c],count:2});var U=T('lineTo');var V=T('moveTo');var W=u('rect');const X=(a)=>{const b=a.canvas[Symbol.for('mouseData')];b&&(b.dx=b.x-b.previousX,b.dy=b.y-b.previousY,b.previousX=b.x,b.previousY=b.y,b.clicked=0)},Y=(g,h,[i,a,b,c,d,e])=>{g[h-6]=i,g[h-5]=a,g[h-4]=b,g[h-3]=c,g[h-2]=d,g[h-1]=e},Z=(g,h,[i,a,b,c,d,e],{x:f,y:j})=>{g[h-6]=i*f,g[h-5]=a*f,g[h-4]=b*j,g[h-3]=c*j,g[h-2]=d,g[h-1]=e},$=(g,h,[i,a,b,c,d,e],{x:f,y:j})=>{g[h-6]=i,g[h-5]=a,g[h-4]=b,g[h-3]=c,g[h-2]=d+i*f+b*j,g[h-1]=e+a*f+c*j},_=(g,h,[i,a,b,c,d,e],{sin:f,cos:j})=>{g[h-6]=i*j+b*f,g[h-5]=a*j+c*f,g[h-4]=i*-f+b*j,g[h-3]=a*-f+c*j,g[h-2]=d,g[h-1]=e},aa=(g,h,[i,a,b,c,d,e],{x:f})=>{g[h-6]=i,g[h-5]=a,g[h-4]=i*f+b,g[h-3]=a*f+c,g[h-2]=d,g[h-1]=e},ba=(g,h,[i,a,b,c,d,e],{y:f})=>{g[h-6]=b*f+i,g[h-5]=c*f+a,g[h-4]=b,g[h-3]=c,g[h-2]=d,g[h-1]=e},ca=()=>({fillStyle:[],strokeStyle:[],globalCompositeOperation:[],imageSmoothingEnabled:[],font:[],textAlign:[],textBaseline:[],direction:[],shadowBlur:[],shadowColor:[],shadowOffsetX:[],shadowOffsetY:[],lineCap:[],lineDash:[],lineDashOffset:[],lineJoin:[],miterLimit:[],lineWidth:[],globalAlpha:[]}),da=[1,0,0,1,0,0],ea=[],fa=[].concat,ga={transform:!0,scale:!0,rotate:!0,translate:!0,skewX:!0,skewY:!0},ha={transform:!0,scale:!0,rotate:!0,translate:!0,skewX:!0,skewY:!0,setTransform:!0},ia=new q('restore'),ja=(a,...b)=>[new q('setTransform',[a[0],a[1],a[2],a[3],a[4],a[5]]),b,ia],ka=new q('restore'),la=new q('restore');var ma=A('shadowBlur'),na=A('shadowColor'),oa=A('shadowOffsetX'),pa=A('shadowOffsetY');const qa=new q('restore'),ra=new q('restore');var sa=s('stroke');var ta=u('strokeRect'),ua=A('strokeStyle'),va=G('strokeText'),wa=A('textAlign'),xa=A('textBaseline');const ya=new q('restore'),za=new q('restore');return{activeRegions:(a)=>{const b=a.canvas[Symbol.for('regions')],c=a.canvas[Symbol.for('mousePoints')],d=a.canvas[Symbol.for('mouseData')],g={};0===c.length&&c.push([d.x,d.y,d.state]);for(const h of Object.values(b)){const a='hitRegion'===h.type?c:e(c,f(h.matrix)),b='hitRegion'===h.type?o:'hitRect'===h.type?i:'hitPolygon'===h.type?k:'hitCircle'===h.type?j:p;for(const c of a)if(b(c,h.points)){h.hover=!0,h.clicked=!!d.clicked,g[h.id]=h;break}}return g},arc:(...a)=>3<a.length?new q('call',{name:'arc',args:a,count:6}):1<a.length?new q('call',{name:'arc',args:[a[0],a[1],a[2],0,r,!1],count:6}):new q('call',{name:'arc',args:[0,0,a[0],0,r,!1],count:6}),arcTo:(a,b,c,d,e)=>new q('call',{name:'arcTo',args:[a,b,c,d,e],count:5}),beginPath:t,bezierCurveTo:(a,b,c,d,e,f)=>new q('call',{name:'bezierCurveTo',args:[a,b,c,d,e,f],count:5}),clearRect:v,clip:(a,...b)=>[w,a,x,b,y],clipPath:()=>new q('call',{name:'clip',args:[],count:0}),closePath:z,createRegularPolygon:(a=0,d=[0,0],e=3)=>{const f=[],g=r/e;for(let h=0;h<e;h++)f.push([d[0]+a*c(g*h),d[1]+a*b(g*h)]);return f},direction:B,drawImage:(...a)=>{if(9<=a.length)return new q('call',{name:'drawImage',args:a,count:9});const[b,c,d,e,f,g,h,i,j]=a;return 5<=a.length?new q('call',{name:'drawImage',args:[b,c,d,e,f],count:5}):new q('call',{name:'drawImage',args:3<=a.length?[b,c,d]:[b,0,0],count:3})},ellipse:(...a)=>{const[b,c,d,e,f,g,h,i]=a;return new q('call',{name:'ellipse',args:5<a.length?a:4<a.length?[b,c,d,e,f,g,!1]:2<a.length?[b,c,d,e,0,pi2,!1]:[0,0,b,c,0,r,!1],count:7})},endClip:C,extend:(a,...b)=>{const c=a[Symbol.for('extensions')]||(a[Symbol.for('extensions')]={});Object.assign(c,...b)},fill:D,fillArc:(...a)=>{const b=[0,0,a[0],0,r,!1];return 3<a.length&&(b[3]=a[3],b[4]=a[4],b[5]=!!a[5]),2<=a.length&&(b[0]=a[0],b[1]=a[1],b[2]=a[2]),new q('fillArc',b)},fillRect:E,fillStyle:F,fillText:H,font:I,globalAlpha:J,globalCompositeOperation:K,hitCircle:(a,...b)=>new q('hitCircle',{id:a,points:1===b.length?[0,0,b[0]]:[b[0],b[1],b[2]]}),hitRect:(a,...b)=>{let[c,d,e,f]=b;return 3>=b.length&&(e=c,f=d,c=0,d=0),new q('hitRect',{id:a,points:[[c,d],[c+e,d+f]]})},hitPolygon:(a,b)=>new q('hitPolygon',{id:a,points:b}),hitRegion:(a,b=null)=>new q('hitRegion',{id:a,fillRule:b}),imageSmoothingEnabled:L,initialize:(a)=>{const{canvas:b}=a;b[Symbol.for('mouseData')]={x:0,y:0,dx:0,dy:0,previousX:0,previousY:0,state:!1,clicked:0};const c=b[Symbol.for('keyData')]={};for(const b in M.code)M.code.hasOwnProperty(b)&&(c[b]=!1);b[Symbol.for('regions')]={},b[Symbol.for('mousePoints')]=[],b.tabIndex=1;const d=(a)=>{const{clientX:c,clientY:d}=a,{left:e,top:f}=b.getBoundingClientRect(),g=b[Symbol.for('mouseData')],h=[c-e,d-f,g.state];g.x=h[0],g.y=h[1];const i=b[Symbol.for('mousePoints')];return i.push(h),100<i.length&&i.splice(0,i.length-100),a.preventDefault(),!1},e='undefined'==typeof window?b:window;b.addEventListener('mousemove',d),b.addEventListener('mousedown',(a)=>{const{target:c}=a;if(c===b){const c=b[Symbol.for('mouseData')];return c.state||(c.clicked+=1),c.state=!0,d(a)}}),b.addEventListener('keydown',(a)=>(b[Symbol.for('keyData')][M(a.keyCode)]=!0,a.preventDefault(),!1)),e.addEventListener('mouseup',(a)=>{const c=b[Symbol.for('mouseData')];c.state=!1,d(a)}),e.addEventListener('keyup',(a)=>{b[Symbol.for('keyData')][M(a.keyCode)]=!1,a.preventDefault()})},Instruction:q,invertMatrix:f,keyData:(a)=>a.canvas[Symbol.for('keyData')],lineStyle:({lineCap:a,lineDash:b,lineDashOffset:c,lineJoin:d,lineWidth:e,miterLimit:f},...g)=>(g=a?N(g):g,g=b?O(g):g,g=null==c?g:P(g),g=d?Q(g):g,g=null==e?g:R(g),null==f?g:S(g)),lineTo:U,mouseData:(a)=>a.canvas[Symbol.for('mouseData')],moveTo:V,moveToLineTo:(a,b)=>0===b?V(a[0],a[1]):U(a[0],a[1]),path:(...a)=>[t(),a,z()],pointInRect:i,quadraticCurveTo:(a,b,c,d)=>new q('call',{name:'quadraticCurveTo',args:[a,b,c,d],count:4}),raf:(a)=>{const b=function(){return requestAnimationFrame(b),a()};requestAnimationFrame(b)},rect:W,removeRegion:(a)=>new q('removeRegion',{id:a}),render:(...a)=>{let b,c=a.slice(0,-1),d=!0,e=6,f=new Float64Array(3006);f.set(da);const g=a[a.length-1];X(g);const h=new Float64Array(da),i=g.canvas[Symbol.for('regions')],j=g.canvas[Symbol.for('mousePoints')]=[],k=g.canvas[Symbol.for('extensions')],m=ca();let n=[];f[0]=da[0],f[1]=da[1],f[2]=da[2],f[3]=da[3],f[4]=da[4],f[5]=da[5];let o=c.length;for(let j,p=0;p<o;p++){if(j=c[p],j&&j.constructor===Array){for(c=fa.apply(ea,c),j=c[p];j&&j.constructor===Array;)c=fa.apply(ea,c),j=c[p];o=c.length}if(!j)continue;const{props:a,type:r}=j;switch(ga[r]&&(h[0]=f[e-6],h[1]=f[e-5],h[2]=f[e-4],h[3]=f[e-3],h[4]=f[e-2],h[5]=f[e-1]),ha[r]&&(e+=6,d=!0,e>=f.length&&(b=f,f=new Float64Array(f.length+600),f.set(b))),r){case'transform':transform(f,e,h,a);continue;case'setTransform':Y(f,e,a);continue;case'scale':Z(f,e,h,a);continue;case'translate':$(f,e,h,a);continue;case'rotate':_(f,e,h,a);continue;case'skewX':aa(f,e,h,a);continue;case'skewY':ba(f,e,h,a);continue;case'restore':e-=6,d=!0;continue;}switch(d&&(d=!1,g.setTransform(f[e-6],f[e-5],f[e-4],f[e-3],f[e-2],f[e-1]),n.push(new q('call',{name:'setTransform',args:[f[e-6],f[e-5],f[e-4],f[e-3],f[e-2],f[e-1]],count:6}))),r){case'push':m[a.stack].push('lineDash'===a.stack?g.getLineDash():g[a.stack]),'globalAlpha'===a.stack?g[a.stack]*=a.value:'lineDash'===a.stack?g.setLineDash(a.value):g[a.stack]=a.value;continue;case'pop':if('lineDash'===a.stack){g.setLineDash(m.lineDash.pop());continue}g[a.stack]=m[a.stack].pop();continue;case'call':'beginPath'===name?n=[]:n.push(j),l(g,j);continue;case'strokeArc':n=[],g.beginPath(),g.arc(a[0],a[1],a[2],a[3],a[4],a[5]),g.stroke();continue;case'fillArc':n=[],g.beginPath(),g.arc(a[0],a[1],a[2],a[3],a[4],a[5]),g.fill();continue;case'removeRegion':i[a.id]=null;continue;case'clearRegions':for(const a of Object.values(i))i[a.id]=null;continue;case'hitRect':case'hitPolygon':case'hitCircle':case'hitRegion':i&&(i[a.id]={id:a.id,points:'hitRegion'===r?n.slice():a.points,matrix:[f[e-6],f[e-5],f[e-4],f[e-3],f[e-2],f[e-1]],type:r,fillRule:a.fillRule,hover:!1,touched:!1,clicked:!1});continue;default:k&&k[r]&&k[r](a,g);continue;}}const p=g.canvas[Symbol.for('regions')]={};for(const b of Object.values(i))b&&(p[b.id]=b)},resetTransform:(...a)=>ja([1,0,0,1,0,0],a),rotate:(a,...d)=>[new q('rotate',{cos:c(a),sin:b(a)}),d,ka],scale:(a,b,...c)=>('number'!=typeof b&&(c=[b].concat(c),b=a),[new q('scale',{x:a,y:b}),c,la]),setTransform:ja,shadowBlur:ma,shadowColor:na,shadowOffsetX:oa,shadowOffsetY:pa,shadowStyle:({shadowBlur:a,shadowColor:b,shadowOffsetX:c,shadowOffsetY:d},...e)=>(e=a?ma(e):e,e=b?na(e):e,e=c?oa(e):e,d?pa(e):e),skewX:(b,...c)=>[new q('skewX',{x:a(b)}),c,qa],skewY:(b,...c)=>[new q('skewY',{y:a(b)}),c,ra],stroke:sa,strokeArc:(...a)=>{const b=[0,0,a[0],0,2*d,!1];return 3<a.length&&(b[3]=a[3],b[4]=a[4],b[5]=!!a[5]),2<=a.length&&(b[0]=a[0],b[1]=a[1],b[2]=a[2]),new q('strokeArc',b)},strokeRect:ta,strokeStyle:ua,strokeText:va,textAlign:wa,textBaseline:xa,textStyle:({font:a,textAlign:b,textBaseline:c,direction:d},...e)=>(e=a?I(e):e,e=b?wa(e):e,e=c?xa(e):e,d?B(e):e),transform:(a,...b)=>[new q('transform',[a[0],a[1],a[2],a[3],a[4],a[5]]),b,ya],transformPoints:e,translate:(a,b,...c)=>[new q('translate',{x:a,y:b}),c,za]}});