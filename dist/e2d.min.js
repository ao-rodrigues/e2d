(function(a,b){'object'==typeof exports&&'undefined'!=typeof module?module.exports=b():'function'==typeof define&&define.amd?define(b):a.e2d=b()})(this,function(){'use strict';var a=Math.tan,b=Math.sin,c=Math.cos,d=Math.PI;const e=(a,b)=>{const c=[];let d,e;for(let f=0;f<a.length;f++)[d,e]=a[f],c.push([b[0]*d+b[2]*e+b[4],b[1]*d+b[3]*e+b[5]]);return c};let g=0;const f=([h,a,i,j,d,e])=>(g=1/(h*j-i*a),[j*g,-i*g,-a*g,h*g,(a*e-d*j)*g,(d*a-h*e)*g]),h=([a,b],[[c,d],[e,f]])=>a>c&&b>d&&a<e&&b<f,i=([a,b],[c,d,e])=>(c-a)**2+(d-b)**2<e**2;var j=function(a,b){for(var c=a[0],d=a[1],e=!1,f=0,g=b.length-1;f<b.length;g=f++){var h=b[f][0],i=b[f][1],j=b[g][0],k=b[g][1];i>d!=k>d&&c<(j-h)*(d-i)/(k-i)+h&&(e=!e)}return e};const k=()=>!1;class l{constructor(a,b){return this.type=a,this.props=b,Object.seal(this)}}Object.seal(l),Object.seal(l.prototype);const m=2*d,n=(a)=>()=>new l('call',{name:a,args:[],count:0});var o=n('beginPath');const p=(a)=>(...b)=>new l('call',{name:a,args:2<b.length?b:[0,0,b[0],b[1]],count:4});var q=p('clearRect');const r=[n('save'),n('beginPath')],s=n('clip'),t=n('restore');var u=n('closePath');const v=(a)=>{const b=new l('pop',{stack:a});return(c,...d)=>[new l('push',{stack:a,value:c}),...d,b]};var w=v('direction');var z=2*d;var x=n('restore');var y=n('fill');var A=p('fillRect'),B=v('fillStyle');const C=(a)=>(...b)=>new l('call',{name:a,args:3<=b.length?b:[b[0],0,0],count:4<=b.length?4:3});var D=C('fillText'),E=v('font'),F=v('globalAlpha'),G=v('globalCompositeOperation');var H=v('imageSmoothingEnabled'),I=function(a,b){return b={exports:{}},a(b,b.exports),b.exports}(function(a,b){b=a.exports=function(a){if(a&&'object'==typeof a){var b=a.which||a.keyCode||a.charCode;b&&(a=b)}if('number'==typeof a)return f[a];var e=a+'',g=c[e.toLowerCase()];if(g)return g;var g=d[e.toLowerCase()];return g?g:1===e.length?e.charCodeAt(0):void 0};var c=b.code=b.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,command:91,"left command":91,"right command":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},d=b.aliases={windows:91,"⇧":16,"⌥":18,"⌃":17,"⌘":91,ctl:17,control:17,option:18,pause:19,break:19,caps:20,return:13,escape:27,spc:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91};for(e=97;123>e;e++)c[String.fromCharCode(e)]=e-32;for(var e=48;58>e;e++)c[e-48]=e;for(e=1;13>e;e++)c['f'+e]=e+111;for(e=0;10>e;e++)c['numpad '+e]=e+96;var f=b.names=b.title={};for(e in c)f[c[e]]=e;for(var g in d)c[g]=d[g]});var J=v('lineCap'),K=v('lineDash'),L=v('lineDashOffset'),M=v('lineJoin'),N=v('lineWidth'),O=v('miterLimit');const P=(a)=>(b,c)=>new l('call',{name:a,args:[b,c],count:2});var Q=P('lineTo');var R=P('moveTo');var S=p('rect');const T=(a)=>{const b=a.canvas[Symbol.for('mouseData')];b&&(b.dx=b.x-b.previousX,b.dy=b.y-b.previousY,b.previousX=b.x,b.previousY=b.y,b.clicked=0)},U=[1,0,0,1,0,0],V=[],W=[].concat,X={transform:!0,scale:!0,rotate:!0,translate:!0,skewX:!0,skewY:!0},Y={transform:!0,scale:!0,rotate:!0,translate:!0,skewX:!0,skewY:!0,setTransform:!0},Z=new l('restore'),$=(a,...b)=>[new l('setTransform',[a[0],a[1],a[2],a[3],a[4],a[5]]),b,Z],_=new l('restore'),aa=new l('restore');var ba=v('shadowBlur'),ca=v('shadowColor'),da=v('shadowOffsetX'),ea=v('shadowOffsetY');const fa=new l('restore'),ga=new l('restore');var ha=n('stroke');var ia=p('strokeRect'),ja=v('strokeStyle'),ka=C('strokeText'),la=v('textAlign'),ma=v('textBaseline');const na=new l('restore'),oa=new l('restore');return{activeRegions:(a)=>{const b=a.canvas[Symbol.for('regions')],c=a.canvas[Symbol.for('mousePoints')],d=a.canvas[Symbol.for('mouseData')],g={};0===c.length&&c.push([d.x,d.y,d.state]);for(const l of b){const a=e(c,f(l.matrix)),b='hitRect'===l.type?h:'hitRegion'===l.type?j:'hitCircle'===l.type?i:k;for(const c of a)if(b(c,l.points)){l.hover=!0,l.clicked=!!d.clicked,g[l.id]=l;break}}return g},arc:(...a)=>3<a.length?new l('call',{name:'arc',args:a,count:6}):1<a.length?new l('call',{name:'arc',args:[a[0],a[1],a[2],0,m,!1],count:6}):new l('call',{name:'arc',args:[0,0,a[0],0,m,!1],count:6}),arcTo:(a,b,c,d,e)=>new l('call',{name:'arcTo',args:[a,b,c,d,e],count:5}),beginPath:o,bezierCurveTo:(a,b,c,d,e,f)=>new l('call',{name:'bezierCurveTo',args:[a,b,c,d,e,f],count:5}),clearRect:q,clip:(a,...b)=>[r,a,s,b,t],clipPath:()=>new l('call',{name:'clip',args:[],count:0}),closePath:u,createRegularPolygon:(a=0,e=[0,0],f=3)=>{const g=[],h=2*d/f;for(let d=0;d<f;d++)g.push([e[0]+a*c(h*d),e[1]+a*b(h*d)]);return g},direction:w,drawImage:(...a)=>{if(9<=a.length)return new l('call',{name:'drawImage',args:a,count:9});const[b,c,d,e,f,g,h,i,j]=a;return 5<=a.length?new l('call',{name:'drawImage',args:[b,c,d,e,f],count:5}):new l('call',{name:'drawImage',args:3<=a.length?[b,c,d]:[b,0,0],count:3})},ellipse:(...a)=>{const[b,c,d,e,f,g,h,i]=a;return new l('call',{name:'ellipse',args:5<a.length?a:4<a.length?[b,c,d,e,f,g,!1]:2<a.length?[b,c,d,e,0,pi2,!1]:[0,0,b,c,0,z,!1],count:7})},endClip:x,extend:(a,...b)=>{const c=a[Symbol.for('extensions')]||(a[Symbol.for('extensions')]={});Object.assign(c,...b)},fill:y,fillArc:(...a)=>{const b=[0,0,a[0],0,z,!1];return 3<a.length&&(b[3]=a[3],b[4]=a[4],b[5]=!!a[5]),2<=a.length&&(b[0]=a[0],b[1]=a[1],b[2]=a[2]),new l('fillArc',b)},fillRect:A,fillStyle:B,fillText:D,font:E,globalAlpha:F,globalCompositeOperation:G,hitCircle:(a,...b)=>new l('hitCircle',{id:a,points:1===b.length?[0,0,b[0]]:[b[0],b[1],b[2]]}),hitRect:(a,...b)=>{let[c,d,e,f]=b;return 3>=b.length&&(e=c,f=d,c=0,d=0),new l('hitRect',{id:a,points:[[c,d],[c+e,d+f]]})},hitRegion:(a,b)=>new l('hitRegion',{id:a,points:b}),imageSmoothingEnabled:H,initialize:(a)=>{const{canvas:b}=a;b[Symbol.for('mouseData')]={x:0,y:0,dx:0,dy:0,previousX:0,previousY:0,state:!1,clicked:0};const c=b[Symbol.for('keyData')]={};for(const b in I.code)I.code.hasOwnProperty(b)&&(c[b]=!1);b[Symbol.for('regions')]=[],b[Symbol.for('mousePoints')]=[],b.tabIndex=1;const d=(a)=>{const{clientX:c,clientY:d}=a,{left:e,top:f}=b.getBoundingClientRect(),g=b[Symbol.for('mouseData')],h=[c-e,d-f,g.state];g.x=h[0],g.y=h[1];const i=b[Symbol.for('mousePoints')];return i.push(h),100<i.length&&i.splice(0,i.length-100),a.preventDefault(),!1},e='undefined'==typeof window?b:window;b.addEventListener('mousemove',d),b.addEventListener('mousedown',(a)=>{const{target:c}=a;if(c===b){const c=b[Symbol.for('mouseData')];return c.state||(c.clicked+=1),c.state=!0,d(a)}}),b.addEventListener('keydown',(a)=>(b[Symbol.for('keyData')][I(a.keyCode)]=!0,a.preventDefault(),!1)),e.addEventListener('mouseup',(a)=>{const c=b[Symbol.for('mouseData')];c.state=!1,d(a)}),e.addEventListener('keyup',(a)=>{b[Symbol.for('keyData')][I(a.keyCode)]=!1,a.preventDefault()})},Instruction:l,invertMatrix:f,keyData:(a)=>a.canvas[Symbol.for('keyData')],lineStyle:({lineCap:a,lineDash:b,lineDashOffset:c,lineJoin:d,lineWidth:e,miterLimit:f},...g)=>(g=a?J(g):g,g=b?K(g):g,g=null==c?g:L(g),g=d?M(g):g,g=null==e?g:N(g),null==f?g:O(g)),lineTo:Q,mouseData:(a)=>a.canvas[Symbol.for('mouseData')],moveTo:R,moveToLineTo:(a,b)=>0===b?R(a[0],a[1]):Q(a[0],a[1]),path:(...a)=>[o(),a,u()],pointInRect:h,quadraticCurveTo:(a,b,c,d)=>new l('call',{name:'quadraticCurveTo',args:[a,b,c,d],count:4}),raf:(a)=>{const b=function(){return requestAnimationFrame(b),a()};requestAnimationFrame(b)},rect:S,render:(...a)=>{let b,c=a.slice(0,-1),d=!0,e=6,f=new Float64Array(3006);f.set(U);const g=a[a.length-1];T(g);const h=new Float64Array(U),i=g.canvas[Symbol.for('regions')]=[],j=g.canvas[Symbol.for('mousePoints')]=[],k=g.canvas[Symbol.for('extensions')],l={fillStyle:[],strokeStyle:[],globalCompositeOperation:[],imageSmoothingEnabled:[],font:[],textAlign:[],textBaseline:[],direction:[],shadowBlur:[],shadowColor:[],shadowOffsetX:[],shadowOffsetY:[],lineCap:[],lineDash:[],lineDashOffset:[],lineJoin:[],miterLimit:[],lineWidth:[],globalAlpha:[]};f[0]=U[0],f[1]=U[1],f[2]=U[2],f[3]=U[3],f[4]=U[4],f[5]=U[5];const m=()=>{b=f,f=new Float64Array(f.length+600),f.set(b)};let n=c.length;for(let b,j=0;j<n;j++){if(b=c[j],b&&b.constructor===Array){for(c=W.apply(V,c),b=c[j];b&&b.constructor===Array;)c=W.apply(V,c),b=c[j];n=c.length}if(!b)continue;const{props:a,type:o}=b;switch(X[o]&&(h[0]=f[e-6],h[1]=f[e-5],h[2]=f[e-4],h[3]=f[e-3],h[4]=f[e-2],h[5]=f[e-1]),Y[o]&&(e+=6,e>=f.length&&m()),o){case'transform':f[e-6]=h[0]*a[0]+h[2]*a[1],f[e-5]=h[1]*a[0]+h[3]*a[1],f[e-4]=h[0]*a[2]+h[2]*a[3],f[e-3]=h[1]*a[2]+h[3]*a[3],f[e-2]=h[0]*a[4]+h[2]*a[5]+h[4],f[e-1]=h[1]*a[4]+h[3]*a[5]+h[5],d=!0;continue;case'setTransform':f[e-6]=a[0],f[e-5]=a[1],f[e-4]=a[2],f[e-3]=a[3],f[e-2]=a[4],f[e-1]=a[5],d=!0;continue;case'scale':f[e-6]=h[0]*a.x,f[e-5]=h[1]*a.x,f[e-4]=h[2]*a.y,f[e-3]=h[3]*a.y,f[e-2]=h[4],f[e-1]=h[5],d=!0;continue;case'translate':f[e-6]=h[0],f[e-5]=h[1],f[e-4]=h[2],f[e-3]=h[3],f[e-2]=h[4]+h[0]*a.x+h[2]*a.y,f[e-1]=h[5]+h[1]*a.x+h[3]*a.y,d=!0;continue;case'rotate':f[e-6]=h[0]*a.cos+h[2]*a.sin,f[e-5]=h[1]*a.cos+h[3]*a.sin,f[e-4]=h[0]*-a.sin+h[2]*a.cos,f[e-3]=h[1]*-a.sin+h[3]*a.cos,f[e-2]=h[4],f[e-1]=h[5],d=!0;continue;case'skewX':f[e-6]=h[0],f[e-5]=h[1],f[e-4]=h[0]*a.x+h[2],f[e-3]=h[1]*a.x+h[3],f[e-2]=h[4],f[e-1]=h[5],d=!0;continue;case'skewY':f[e-6]=1*h[0]+h[2]*a.y,f[e-5]=1*h[1]+h[3]*a.y,f[e-4]=h[2],f[e-3]=h[3],f[e-2]=h[4],f[e-1]=h[5],d=!0;continue;case'restore':e-=6,d=!0;continue;}switch(d&&(d=!1,g.setTransform(f[e-6],f[e-5],f[e-4],f[e-3],f[e-2],f[e-1])),o){case'push':l[a.stack].push('lineDash'===a.stack?g.getLineDash():g[a.stack]),'globalAlpha'===a.stack?g[a.stack]*=a.value:'lineDash'===a.stack?g.setLineDash(a.value):g[a.stack]=a.value;continue;case'pop':if('lineDash'===a.stack){g.setLineDash(l.lineDash.pop());continue}g[a.stack]=l[a.stack].pop();continue;case'call':const{name:b,args:c,count:h}=a;switch(h){case 0:g[b]();continue;case 1:g[b](c[0]);continue;case 2:g[b](c[0],c[1]);continue;case 3:g[b](c[0],c[1],c[2]);continue;case 4:g[b](c[0],c[1],c[2],c[3]);continue;case 5:g[b](c[0],c[1],c[2],c[3],c[4]);continue;case 6:g[b](c[0],c[1],c[2],c[3],c[4],c[5]);continue;case 7:g[b](c[0],c[1],c[2],c[3],c[4],c[5],c[6]);continue;case 8:g[b](c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7]);continue;case 9:g[b](c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8]);continue;}case'strokeArc':g.beginPath(),g.arc(a[0],a[1],a[2],a[3],a[4],a[5]),g.closePath(),g.stroke();continue;case'fillArc':g.beginPath(),g.arc(a[0],a[1],a[2],a[3],a[4],a[5]),g.closePath(),g.fill();continue;case'hitRect':case'hitRegion':case'hitCircle':i&&i.push({id:a.id,points:a.points,matrix:[f[e-6],f[e-5],f[e-4],f[e-3],f[e-2],f[e-1]],type:o,hover:!1,touched:!1,clicked:!1});continue;default:k&&k[o]&&k[o](a,g);continue;}}},resetTransform:(...a)=>$([1,0,0,1,0,0],a),rotate:(a,...d)=>[new l('rotate',{cos:c(a),sin:b(a)}),d,_],scale:(a,b,...c)=>('number'!=typeof b&&(c=[b].concat(c),b=a),[new l('scale',{x:a,y:b}),c,aa]),setTransform:$,shadowBlur:ba,shadowColor:ca,shadowOffsetX:da,shadowOffsetY:ea,shadowStyle:({shadowBlur:a,shadowColor:b,shadowOffsetX:c,shadowOffsetY:d},...e)=>(e=a?ba(e):e,e=b?ca(e):e,e=c?da(e):e,d?ea(e):e),skewX:(b,...c)=>[new l('skewX',{x:a(b)}),c,fa],skewY:(b,...c)=>[new l('skewY',{y:a(b)}),c,ga],stroke:ha,strokeArc:(...a)=>{const b=[0,0,a[0],0,2*d,!1];return 3<a.length&&(b[3]=a[3],b[4]=a[4],b[5]=!!a[5]),2<=a.length&&(b[0]=a[0],b[1]=a[1],b[2]=a[2]),new l('strokeArc',b)},strokeRect:ia,strokeStyle:ja,strokeText:ka,textAlign:la,textBaseline:ma,textStyle:({font:a,textAlign:b,textBaseline:c,direction:d},...e)=>(e=a?E(e):e,e=b?la(e):e,e=c?ma(e):e,d?w(e):e),transform:(a,...b)=>[new l('transform',[a[0],a[1],a[2],a[3],a[4],a[5]]),b,na],transformPoints:e,translate:(a,b,...c)=>[new l('translate',{x:a,y:b}),c,oa]}});