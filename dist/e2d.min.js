(function(a,b){'object'==typeof exports&&'undefined'!=typeof module?module.exports=b():'function'==typeof define&&define.amd?define(b):a.e2d=b()})(this,function(){'use strict';function a(g,[h,a,b,c,d,e]){const f=[];let i,j;for(const k of g)[i,j]=k,f.push([h*i+b*j+d,a*i+c*j+e]);return f}function b(a,b){switch(b.props.count){case 0:return a[b.props.name]();case 1:return a[b.props.name](b.props.args[0]);case 2:return a[b.props.name](b.props.args[0],b.props.args[1]);case 3:return a[b.props.name](b.props.args[0],b.props.args[1],b.props.args[2]);case 4:return a[b.props.name](b.props.args[0],b.props.args[1],b.props.args[2],b.props.args[3]);case 5:return a[b.props.name](b.props.args[0],b.props.args[1],b.props.args[2],b.props.args[3],b.props.args[4]);case 6:return a[b.props.name](b.props.args[0],b.props.args[1],b.props.args[2],b.props.args[3],b.props.args[4],b.props.args[5]);case 7:return a[b.props.name](b.props.args[0],b.props.args[1],b.props.args[2],b.props.args[3],b.props.args[4],b.props.args[5],b.props.args[6]);case 8:return a[b.props.name](b.props.args[0],b.props.args[1],b.props.args[2],b.props.args[3],b.props.args[4],b.props.args[5],b.props.args[6],b.props.args[7]);case 9:return a[b.props.name](b.props.args[0],b.props.args[1],b.props.args[2],b.props.args[3],b.props.args[4],b.props.args[5],b.props.args[6],b.props.args[7],b.props.args[8]);}}function c(a){const b=a.canvas[Symbol.for('mouseData')];b&&(b.dx=b.x-b.previousX,b.dy=b.y-b.previousY,b.previousX=b.x,b.previousY=b.y,b.clicked=0)}function d(a,b,c,d){a[b-6]=c[0],a[b-5]=c[1],a[b-4]=c[2],a[b-3]=c[3],a[b-2]=c[4]+c[0]*d.x+c[2]*d.y,a[b-1]=c[5]+c[1]*d.x+c[3]*d.y}function e(){return{fillStyle:[],strokeStyle:[],globalCompositeOperation:[],imageSmoothingEnabled:[],font:[],textAlign:[],textBaseline:[],direction:[],shadowBlur:[],shadowColor:[],shadowOffsetX:[],shadowOffsetY:[],lineCap:[],lineDash:[],lineDashOffset:[],lineJoin:[],miterLimit:[],lineWidth:[],globalAlpha:[]}}var f=Math.tan,g=Math.sin,h=Math.cos;let i=0;const j=([g,a,h,j,d,e])=>(i=1/(g*j-h*a),[j*i,-h*i,-a*i,g*i,(a*e-d*j)*i,(d*a-g*e)*i]),k=([a,b],[[c,d],[e,f]])=>a>c&&b>d&&a<e&&b<f,l=([a,b],[c,d,e])=>(c-a)**2+(d-b)**2<e**2;var m=function(a,b){for(var c=a[0],d=a[1],e=!1,f=0,g=b.length-1;f<b.length;g=f++){var h=b[f][0],i=b[f][1],j=b[g][0],k=b[g][1];i>d!=k>d&&c<(j-h)*(d-i)/(k-i)+h&&(e=!e)}return e};const n=[],o=n.concat;var p=([a,c],d)=>{const e=document.createElement('canvas').getContext('2d');e.canvas.width=1,e.canvas.height=1;for(let f=0;f<d.length;f++){for(;d[f]&&d[f].constructor===Array;)d=o.apply(n,d);d[f]&&b(e,d[f])}return e.isPointInPath(a,c)};const q=()=>!1;class s{constructor(a,b){return this.type=a,this.props=b,Object.seal(this)}}Object.seal(s),Object.seal(s.prototype);var t=2*Math.PI;const r=(a)=>function(){return new s('call',{name:a,args:[],count:0})};var u=r('beginPath');const v=(a)=>(...b)=>new s('call',{name:a,args:2<b.length?b:[0,0,b[0],b[1]],count:4});var w=v('clearRect');const x=r('clip'),y=r('save')(),z=u(),A=x(),B=r('restore')();var C=r('closePath');const D=(a)=>{const b=new s('pop',{stack:a});return(c,...d)=>[new s('push',{stack:a,value:c}),...d,b]};var E=D('direction'),F=r('restore'),G=r('fill'),H=v('fillRect'),I=D('fillStyle');const J=(a)=>function(b,c,d,e){return new s('call',{name:a,args:3<arguments.length?[b,c,d,e]:1<=arguments.length?[b,c,d]:[b,0,0],count:3<arguments.length?4:3})};var K=J('fillText'),L=D('font'),M=D('globalAlpha'),N=D('globalCompositeOperation'),O=D('imageSmoothingEnabled'),P=function(a,b){return b={exports:{}},a(b,b.exports),b.exports}(function(a,b){b=a.exports=function(a){if(a&&'object'==typeof a){var b=a.which||a.keyCode||a.charCode;b&&(a=b)}if('number'==typeof a)return f[a];var e=a+'',g=c[e.toLowerCase()];if(g)return g;var g=d[e.toLowerCase()];return g?g:1===e.length?e.charCodeAt(0):void 0};var c=b.code=b.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,command:91,"left command":91,"right command":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},d=b.aliases={windows:91,"⇧":16,"⌥":18,"⌃":17,"⌘":91,ctl:17,control:17,option:18,pause:19,break:19,caps:20,return:13,escape:27,spc:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91};for(e=97;123>e;e++)c[String.fromCharCode(e)]=e-32;for(var e=48;58>e;e++)c[e-48]=e;for(e=1;13>e;e++)c['f'+e]=e+111;for(e=0;10>e;e++)c['numpad '+e]=e+96;var f=b.names=b.title={};for(e in c)f[c[e]]=e;for(var g in d)c[g]=d[g]});var Q=D('lineCap'),R=D('lineDash'),S=D('lineDashOffset'),T=D('lineJoin'),U=D('lineWidth'),V=D('miterLimit');const W=(a)=>(b,c)=>new s('call',{name:a,args:[b,c],count:2});var X=W('lineTo');var Y=W('moveTo');var Z=v('rect');const $=(a,b,c)=>{a[b-6]=c[0],a[b-5]=c[1],a[b-4]=c[2],a[b-3]=c[3],a[b-2]=c[4],a[b-1]=c[5]},_=(a,b,c,d)=>{a[b-6]=c[0]*d.x,a[b-5]=c[1]*d.x,a[b-4]=c[2]*d.y,a[b-3]=c[3]*d.y,a[b-2]=c[4],a[b-1]=c[5]},aa=(a,b,c,d)=>{a[b-6]=c[0]*d.cos+c[2]*d.sin,a[b-5]=c[1]*d.cos+c[3]*d.sin,a[b-4]=c[0]*-d.sin+c[2]*d.cos,a[b-3]=c[1]*-d.sin+c[3]*d.cos,a[b-2]=c[4],a[b-1]=c[5]},ba=(a,b,c,d)=>{a[b-6]=c[0],a[b-5]=c[1],a[b-4]=c[0]*d.x+c[2],a[b-3]=c[1]*d.x+c[3],a[b-2]=c[4],a[b-1]=c[5]},ca=(a,b,c,d)=>{a[b-6]=c[2]*d.y+c[0],a[b-5]=c[3]*d.y+c[1],a[b-4]=c[2],a[b-3]=c[3],a[b-2]=c[4],a[b-1]=c[5]},da=[1,0,0,1,0,0],ea=[],fa=[].concat,ga={transform:!0,scale:!0,rotate:!0,translate:!0,skewX:!0,skewY:!0},ha={transform:!0,scale:!0,rotate:!0,translate:!0,skewX:!0,skewY:!0,setTransform:!0},ia=CanvasRenderingContext2D.prototype.hasOwnProperty('currentTransform'),ja=new s('restore'),ka=(a,...b)=>[new s('setTransform',[a[0],a[1],a[2],a[3],a[4],a[5]]),b,ja],la=new s('restore'),ma=new s('restore');var na=D('shadowBlur'),oa=D('shadowColor'),pa=D('shadowOffsetX'),qa=D('shadowOffsetY');const ra=new s('restore'),sa=new s('restore');var ta=r('stroke');var ua=v('strokeRect'),va=D('strokeStyle'),wa=J('strokeText'),xa=D('textAlign'),ya=D('textBaseline');const za=new s('restore'),Aa=new s('restore');return{activeRegions:function(b){const c=b.canvas[Symbol.for('regions')],d=b.canvas[Symbol.for('mousePoints')],e=b.canvas[Symbol.for('mouseData')],f={};0===d.length&&d.push([e.x,e.y,e.state]);for(const g of Object.values(c)){const b='hitRegion'===g.type?d:a(d,j(g.matrix)),c='hitRegion'===g.type?p:'hitRect'===g.type?k:'hitPolygon'===g.type?m:'hitCircle'===g.type?l:q;for(const a of b)if(c(a,g.points)){g.hover=!0,g.clicked=!!e.clicked,f[g.id]=g;break}}return f},arc:function(a,b,c,d,e,f){return 3<arguments.length?new s('call',{name:'arc',args:[a,b,c,d,e,!!f],count:6}):1<arguments.length?new s('call',{name:'arc',args:[a,b,c,0,t,!1],count:6}):new s('call',{name:'arc',args:[0,0,a,0,t,!1],count:6})},arcTo:function(a,b,c,d,e){return new s('call',{name:'arcTo',args:[a,b,c,d,e],count:5})},beginPath:u,bezierCurveTo:function(a,b,c,d,e,f){return new s('call',{name:'bezierCurveTo',args:[a,b,c,d,e,f],count:5})},clearRect:w,clip:function(a,...b){return[y,z,a,A,b,B]},clipPath:x,closePath:C,createRegularPolygon:function(a=0,b=[0,0],c=3){const d=[];let e=0;for(let f=0;f<c;f++)d.push([b[0]+a*h(e),b[1]+a*g(e)]),e+=t/c;return d},direction:E,drawImage:function(a,b,c,d,e,f,g,h,i){return 9<=arguments.length?new s('call',{name:'drawImage',args:[a,b,c,d,e,f,g,h,i],count:9}):5<=arguments.length?new s('call',{name:'drawImage',args:[a,b,c,d,e],count:5}):new s('call',{name:'drawImage',args:3<=arguments.length?[a,b,c]:[a,0,0],count:3})},ellipse:function(a,b,c,d,e,f,g,h){return new s('call',{name:'ellipse',args:6<=arguments.length?[a,b,c,d,e,f,g,!!h]:5===arguments.length?[a,b,c,d,e,0,t,!1]:3<=arguments.length?[a,b,c,d,0,0,t,!1]:[0,0,a,b,0,t,!1],count:7})},endClip:F,extend:function(a,...b){const c=a[Symbol.for('extensions')]||(a[Symbol.for('extensions')]={});Object.assign(c,...b)},fill:G,fillArc:function(a,b,c,d,e,f){const g=[0,0,a,0,t,!1];return 3<arguments.length&&(g[3]=d,g[4]=e,g[5]=!!f),2<=arguments.length&&(g[0]=a,g[1]=b,g[2]=c),new s('fillArc',g)},fillRect:H,fillStyle:I,fillText:K,font:L,globalAlpha:M,globalCompositeOperation:N,hitCircle:function(a,b,c,d){return new s('hitCircle',{id:a,points:1===arguments.length?[0,0,b]:[b,c,d]})},hitRect:function(a,b,c,d,e){return 3>=arguments.length&&(d=b,e=c,b=0,c=0),new s('hitRect',{id:a,points:[[b,c],[b+d,c+e]]})},hitPolygon:function(a,b){return new s('hitPolygon',{id:a,points:b})},hitRegion:function(a,b=null){return new s('hitRegion',{id:a,fillRule:b})},imageSmoothingEnabled:O,initialize:(a)=>{const{canvas:b}=a;b[Symbol.for('mouseData')]={x:0,y:0,dx:0,dy:0,previousX:0,previousY:0,state:!1,clicked:0};const c=b[Symbol.for('keyData')]={};for(const b in P.code)P.code.hasOwnProperty(b)&&(c[b]=!1);b[Symbol.for('regions')]={},b[Symbol.for('mousePoints')]=[],b.tabIndex=1;const d=(a)=>{const{clientX:c,clientY:d}=a,{left:e,top:f}=b.getBoundingClientRect(),g=b[Symbol.for('mouseData')],h=[c-e,d-f,g.state];g.x=h[0],g.y=h[1];const i=b[Symbol.for('mousePoints')];return i.push(h),100<i.length&&i.splice(0,i.length-100),a.preventDefault(),!1},e='undefined'==typeof window?b:window;b.addEventListener('mousemove',d),b.addEventListener('mousedown',(a)=>{const{target:c}=a;if(c===b){const c=b[Symbol.for('mouseData')];return c.state||(c.clicked+=1),c.state=!0,d(a)}}),b.addEventListener('keydown',(a)=>(b[Symbol.for('keyData')][P(a.keyCode)]=!0,a.preventDefault(),!1)),e.addEventListener('mouseup',(a)=>{const c=b[Symbol.for('mouseData')];c.state=!1,d(a)}),e.addEventListener('keyup',(a)=>{b[Symbol.for('keyData')][P(a.keyCode)]=!1,a.preventDefault()})},Instruction:s,invertMatrix:j,keyData:(a)=>a.canvas[Symbol.for('keyData')],lineStyle:function(a,...b){return b=a.lineCap?Q(a.lineCap,b):b,b=a.lineDash?R(a.lineDash,b):b,b=null==a.lineDashOffset?b:S(a.lineDashOffset,b),b=a.lineJoin?T(a.lineJoin,b):b,b=null==a.lineWidth?b:U(a.lineWidth,b),null==a.miterLimit?b:V(a.miterLimit,b)},lineTo:X,mouseData:(a)=>a.canvas[Symbol.for('mouseData')],moveTo:Y,moveToLineTo:function(a,b){return 0===b?Y(a[0],a[1]):X(a[0],a[1])},path:function(...a){return[u(),a,C()]},pointInRect:k,quadraticCurveTo:(a,b,c,d)=>new s('call',{name:'quadraticCurveTo',args:[a,b,c,d],count:4}),raf:(a)=>{const b=function(){return requestAnimationFrame(b),a()};requestAnimationFrame(b)},rect:Z,removeRegion:(a)=>new s('removeRegion',{id:a}),render:(...a)=>{let f,g=a.slice(0,-1),h=!0,i=6,j=new Float64Array(306);const k=a[a.length-1];if(c(k),ia){const{currentTransform:a}=k;j.set([a.a,a.b,a.c,a.d,a.e,a.f])}else j.set(da);const l=new Float64Array(da),m=k.canvas[Symbol.for('regions')],n=k.canvas[Symbol.for('mousePoints')]=[],o=k.canvas[Symbol.for('extensions')],p=e();let q=[],r=g.length;for(let c,e=0;e<r;e++){if(c=g[e],c&&c.constructor===Array){for(g=fa.apply(ea,g),c=g[e];c&&c.constructor===Array;)g=fa.apply(ea,g),c=g[e];r=g.length}if(!c)continue;const{props:a,type:n}=c;switch(ga[n]&&(l[0]=j[i-6],l[1]=j[i-5],l[2]=j[i-4],l[3]=j[i-3],l[4]=j[i-2],l[5]=j[i-1]),ha[n]&&(i+=6,h=!0,i>=j.length&&(f=j,j=new Float64Array(j.length+600),j.set(f))),n){case'transform':transform(j,i,l,a);continue;case'setTransform':$(j,i,a);continue;case'scale':_(j,i,l,a);continue;case'translate':d(j,i,l,a);continue;case'rotate':aa(j,i,l,a);continue;case'skewX':ba(j,i,l,a);continue;case'skewY':ca(j,i,l,a);continue;case'restore':i-=6,h=!0;continue;}switch(h&&(h=!1,k.setTransform(j[i-6],j[i-5],j[i-4],j[i-3],j[i-2],j[i-1]),q.push(new s('call',{name:'setTransform',args:[j[i-6],j[i-5],j[i-4],j[i-3],j[i-2],j[i-1]],count:6}))),n){case'push':p[a.stack].push('lineDash'===a.stack?k.getLineDash():k[a.stack]),'globalAlpha'===a.stack?k[a.stack]*=a.value:'lineDash'===a.stack?k.setLineDash(a.value):k[a.stack]=a.value;continue;case'pop':if('lineDash'===a.stack){k.setLineDash(p.lineDash.pop());continue}k[a.stack]=p[a.stack].pop();continue;case'call':'beginPath'===name?q=[]:q.push(c),b(k,c);continue;case'strokeArc':case'fillArc':q=0<q.length?[]:q,k.beginPath(),k.arc(a[0],a[1],a[2],a[3],a[4],a[5]),'strokeArc'===n?k.stroke():k.fill();continue;case'removeRegion':m[a.id]=null;continue;case'clearRegions':for(const a of Object.values(m))m[a.id]=null;continue;case'hitRect':case'hitPolygon':case'hitCircle':case'hitRegion':m&&(m[a.id]={id:a.id,points:'hitRegion'===n?q.slice():a.points,matrix:'hitRegion'===n?da:[j[i-6],j[i-5],j[i-4],j[i-3],j[i-2],j[i-1]],type:n,fillRule:a.fillRule,hover:!1,touched:!1,clicked:!1});continue;default:o&&o[n]&&o[n](a,k);continue;}}const t=k.canvas[Symbol.for('regions')]={};for(const b of Object.values(m))b&&(t[b.id]=b)},resetTransform:(...a)=>ka([1,0,0,1,0,0],a),rotate:(a,...b)=>[new s('rotate',{cos:h(a),sin:g(a)}),b,la],scale:(a,b,...c)=>('number'!=typeof b&&(c=[b].concat(c),b=a),[new s('scale',{x:a,y:b}),c,ma]),setTransform:ka,shadowBlur:na,shadowColor:oa,shadowOffsetX:pa,shadowOffsetY:qa,shadowStyle:({shadowBlur:a,shadowColor:b,shadowOffsetX:c,shadowOffsetY:d},...e)=>(e=a?na(e):e,e=b?oa(e):e,e=c?pa(e):e,d?qa(e):e),skewX:(a,...b)=>[new s('skewX',{x:f(a)}),b,ra],skewY:(a,...b)=>[new s('skewY',{y:f(a)}),b,sa],stroke:ta,strokeArc:(...a)=>{const b=[0,0,a[0],0,t,!1];return 3<a.length&&(b[3]=a[3],b[4]=a[4],b[5]=!!a[5]),2<=a.length&&(b[0]=a[0],b[1]=a[1],b[2]=a[2]),new s('strokeArc',b)},strokeRect:ua,strokeStyle:va,strokeText:wa,textAlign:xa,textBaseline:ya,textStyle:function(a,...b){return b=a.font?L(a.font,b):b,b=a.textAlign?xa(a.textAlign,b):b,b=a.textBaseline?ya(a.textBaseline,b):b,a.direction?E(a.direction,b):b},transform:function(a,...b){return[new s('transform',[a[0],a[1],a[2],a[3],a[4],a[5]]),b,za]},transformPoints:a,translate:function(a,b,...c){return[new s('translate',{x:a,y:b}),c,Aa]}}});